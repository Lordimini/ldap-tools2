{% extends "base.html" %}

{% block title %}
    Create User - LDAP Manager
{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center mb-4">Create User Account</h1>
    
    <!-- Flash messages for any errors/warnings -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="alert-messages mb-4">
                {% for category, message in messages %}
                    <div class="alert alert-{% if category == 'error' %}danger{% elif category == 'success' %}success{% else %}{{ category }}{% endif %} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- React App Container -->
    <div id="user-creation-root"></div>
    
    <!-- Configuration pour React -->
    <script>
        window.userCreationConfig = {
            urls: {
                checkNameExists: "{{ url_for('usercreation.check_name_exists') }}",
                checkFavvNatNrExists: "{{ url_for('usercreation.check_favvnatnr_exists') }}",
                previewUserDetails: "{{ url_for('usercreation.preview_user_details') }}",
                autocompleteManagers: "{{ url_for('autocomplete.autocomplete_managers') }}",
                submitForm: "{{ url_for('usercreation.create_user') }}"
            },
            formData: {
                userTypeChoices: {{ form.user_type.choices|tojson }},
                initialValues: {
                    userType: "{{ form_data.user_type if form_data else '' }}",
                    givenName: "{{ form_data.givenName if form_data else '' }}",
                    sn: "{{ form_data.sn if form_data else '' }}",
                    email: "{{ form_data.email if form_data else '' }}",
                    favvNatNr: "{{ form_data.favvNatNr if form_data else '' }}",
                    manager: "{{ form_data.manager if form_data else '' }}"
                },
                csrfToken: "{{ csrf_token() }}"
            }
        };
    </script>
    
    <!-- Inclusion des scripts React -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Inclusion du script principal de notre application -->
    <script src="{{ url_for('static', filename='js/user_creation.jsx') }}" type="text/babel" data-type="module"></script>
</div>
{% endblock %}